# [ë‹¤ë¬¸í™” ê°€ì •ì„ ìœ„í•œ ì¹œêµ¬ ì‚¬ê·€ê¸° í”Œë«í¼]
ë‹¤ê²Œë”ëŠ” ë‹¤ë¬¸í™” ê°€ì •ì˜ ì •ë³´ ì·¨ì•½, ì™¸ë¡œì›€, í•œêµ­ ìƒí™œ ì ì‘ì˜ ì–´ë ¤ì›€ ë“±ì˜ ë¬¸ì œì ì—ì„œ ì¶œë°œí•˜ì—¬, <br>
ë‹¤ë¬¸í™” ê°€ì • ê°„ì˜ ì»¤ë®¤ë‹ˆí‹° í™œì„±í™”ë¥¼ ìœ„í•œ ì¹œêµ¬ ì‚¬ê·€ê¸° í”Œë«í¼ì„ ì œê³µí•©ë‹ˆë‹¤.
![image](https://github.com/Da-gather/Dagather-Backend/assets/79203421/7021c03c-9e73-4507-88c6-9ba7ff9d1fa4)

<br><br>

## í”„ë¡œì íŠ¸ ê¸°ê°„

- 2023.04.01 ~ 2023.05.25

<br>


## íŒ€ì›ì†Œê°œ
| [ìœ¤ì§€ì• ](https://github.com/jiaeYoon) | [ê¹€ë¯¼ì§€](https://github.com/Lightieey)|
| :-----------------------------------: | :-----------------------------------: |
|<img src="https://avatars.githubusercontent.com/u/68904755?v=4" width="100">|<img src="https://avatars.githubusercontent.com/u/79203421?v=4" width="100">|
|                  BE                   |                  BE                  |

<br><br>

## ì£¼ìš” ê¸°ëŠ¥
- **ì¹œêµ¬ ì¶”ì²œ**

  ê°€ì… ëª©ì , ê´€ì‹¬ì‚¬, ê±°ë¦¬, í•œêµ­ê±°ì£¼ê¸°ê°„ ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ í™ˆ í™”ë©´ì—ì„œ ì¹œêµ¬ë¥¼ ì¶”ì²œìˆœìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.
  
  <img width="40%" alt="Screenshot 2024-02-11 at 7 34 41 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/3fdd8f42-62ef-481b-b036-2614fda4418d">
  <img width="40%" alt="Screenshot 2024-02-11 at 7 34 50 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/374bd4a4-f99a-4e39-8102-a25999c3c4d7">
  <img width="40%" alt="Screenshot 2024-02-11 at 7 35 12 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/c56d34cb-adee-4ba5-891e-877f19febf41">
  <img width="40%" alt="Screenshot 2024-02-11 at 7 35 01 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/c975e556-3361-44c4-8d06-93727f2cdc14">
  

- **ë§ì¶¤ë²• ê²€ì‚¬ì™€ ë²ˆì—­**
  
  ì¹œêµ¬ì™€ ì±„íŒ…ì„ í•˜ë©° í•œêµ­ì–´ ë§ì¶¤ë²• ê²€ì‚¬ ê¸°ëŠ¥ì„ í†µí•´ í•œêµ­ì–´ ê³µë¶€ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>
  ë‹¤ë¥¸ êµ­ì ì˜ ì¹œêµ¬ì™€ ì›í™œí•œ ì†Œí†µì„ ìœ„í•´ ë²ˆì—­ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

  <img width="30%" alt="Screenshot 2024-02-11 at 7 35 25 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/a725c077-493c-4e6e-a4bc-98126acd7065">
  <img width="30%" alt="Screenshot 2024-02-11 at 7 35 36 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/4ef8bc46-0e72-47dc-bd69-59726483386c">
  <img width="30%" alt="Screenshot 2024-02-11 at 7 35 36 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/1d5c58a4-ee18-4d09-be87-52b1fb330ce7">
  

 
- **ë¯¸ì…˜**
  
  ì¹œêµ¬ì™€ ë” ì¹œí•´ì§€ê³ , í•œêµ­ê³¼ë„ ë” ì¹œí•´ì§ˆ ìˆ˜ ìˆë„ë¡ ë‹¤ì–‘í•œ ë¯¸ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤. <br>
  ì¹œêµ¬ì™€ í•¨ê»˜ ë¯¸ì…˜ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê³ , ë§ˆì´í˜ì´ì§€ì—ì„œ ì™„ë£Œí•œ ë¯¸ì…˜ì„ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  <img width="40%" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/d8bf1689-43aa-4256-b39b-3c4cb85a5f67">
  <img width="40%" alt="Screenshot 2024-02-11 at 7 36 18 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/35088c23-a8ac-4852-80dc-523722dd97e7">
  
<br><br>

## ì•„í‚¤í…ì³
<img width="80%" alt="Screenshot 2024-02-11 at 6 46 37 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/ee0eff4e-9662-450c-83fe-30d363a34ef4">

<br><br>

## ERD
<img width="80%" alt="Screenshot 2024-02-11 at 6 46 37 PM" src="https://github.com/Da-gather/Dagather-Backend/assets/79203421/ba875055-e518-45c3-8202-0ae3dd011ebb">
<br><br>

## API ëª…ì„¸
| ê¸°ëŠ¥              | ì„¤ëª…                          |
| ----------------- | ----------------------------- |
| ğŸ‘« ì¹œêµ¬ | ì¹œêµ¬ ì‹ ì²­ ë° ìˆ˜ë½, ì¹œêµ¬ ì‚­ì œ, ì¹œêµ¬ ëª©ë¡ ì¡°íšŒ, ì¹œêµ¬ ì‹ ì²­ ëŒ€ê¸° ëª©ë¡ ì¡°íšŒ |
| ğŸ“ ë¯¸ì…˜ | ëœë¤ ë¯¸ì…˜ ìƒì„±, ë¯¸ì…˜ ì™„ë£Œ, ë¯¸ì…˜ ì¡°íšŒ, ë¯¸ì…˜ í†µê³„ ì¡°íšŒ |
| ğŸ—£ï¸ ì±„íŒ… | ë§ì¶¤ë²• ê²€ì‚¬ |
| ğŸ” í”„ë¡œí•„ | í”„ë¡œí•„ ìƒì„±, ìˆ˜ì •, ì¡°íšŒ |

<br><br>

## ì¹œêµ¬ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜
ì½˜í…ì¸  ê¸°ë°˜ í•„í„°ë§ì„ í™œìš©í•˜ì—¬ ì‚¬ìš©ìì™€ ì˜ ë§ì„ ê²ƒ ê°™ì€ ì‚¬ìš©ìë¥¼ ì„œë¡œì—ê²Œ ì¶”ì²œí•´ì¤ë‹ˆë‹¤.

1. CountVectorizerë¥¼ ì‚¬ìš©í•´ ë™ì¼í•œ ì†ì„± ê°œìˆ˜ë¥¼ ì„¸ê³ , ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
```python
# CountVectorizer
count_vect = CountVectorizer(min_df=0, ngram_range=(1, 1))
purpose_mat = count_vect.fit_transform(df['purpose'])
interest_mat = count_vect.fit_transform(df['interest'])

# calculate cosine similarity
purpose_sim = cosine_similarity(purpose_mat, purpose_mat)
interest_sim = cosine_similarity(interest_mat, interest_mat)
```
<br>

2. ì‚¬ìš©ìì˜ ê°€ì… ëª©ì ì— ë”°ë¼ ê°€ì…ëª©ì /ì·¨ë¯¸/ê±°ë¦¬/ê±°ì£¼ê¸°ê°„ì˜ ê°€ì¤‘ì¹˜ë¥¼ ë‹¬ë¦¬í•˜ì—¬ ìµœì¢… ìœ ì‚¬ë„ë¥¼ ë„ì¶œí•©ë‹ˆë‹¤.
```python
if 'ì¹œëª©' in my_purpose:
    minmax_scaler = MinMaxScaler()
    my_lat = df.loc[profile_idx]['latitude']
    my_long = df.loc[profile_idx]['longitude']
    df['distance'] = df.apply(lambda x : sqrt((my_lat - x['latitude'])**2 + (my_long - x['longitude'])**2), axis=1)
    df['distance_similarity'] = (1 - minmax_scaler.fit_transform(df[['distance']]))
    df['similarity'] = 0.1*df['purpose_similarity'] + 0.6*df['interest_similarity'] + 0.3*df['distance_similarity']
    df = df.sort_values(by="similarity", ascending=False)
    return df['id'].to_list()

elif 'í•œêµ­ìƒí™œì ì‘' in my_purpose:
    minmax_scaler = MinMaxScaler()
    df['rperiod_similarity'] = minmax_scaler.fit_transform(df[['rperiod']])
    df['rperiod_similarity'].apply(lambda x : 1 - x)
    df['similarity'] = 0.2*df['purpose_similarity'] + 0.2*df['interest_similarity'] + 0.6*df['rperiod_similarity']
    df = df.sort_values(by="similarity", ascending=False)
    return df['id'].to_list()

elif 'ìœ¡ì•„ì •ë³´ê³µìœ ' in my_purpose or 'í•œêµ­ì–´ê³µë¶€' in my_purpose:
    df['similarity'] = 0.2*df['purpose_similarity'] + 0.8*df['interest_similarity']
    df = df.sort_values(by="similarity", ascending=False)
    return df['id'].to_list()
```

<br><br>

## ì—ëŸ¬ í•¸ë“¤ë§
Execptionì˜ ì¢…ë¥˜ë¥¼ ì„¸ë¶„í™”í•˜ì—¬ HttpsStatusì— ë§ê²Œ ExceptionHandlerë¥¼ ì»¤ìŠ¤í…€í•˜ì˜€ìŠµë‹ˆë‹¤.

```java
@Slf4j
@RestControllerAdvice
public class RestExceptionHandler {

	@ResponseStatus(HttpStatus.BAD_REQUEST)
	@ExceptionHandler(MethodArgumentNotValidException.class)
	protected ApiResponse<Object> handleMethodArgNotValidException(MethodArgumentNotValidException exception,
		HttpServletRequest request) {
		String message = exception.getBindingResult().getAllErrors().get(0).getDefaultMessage();
		logInfo(request, HttpStatus.BAD_REQUEST, message);
		return ApiResponse.error(HttpStatus.BAD_REQUEST, message);
	}

	@ResponseStatus(HttpStatus.NOT_FOUND)
	@ExceptionHandler(NotFoundException.class)
	public ApiResponse<Object> handleNotFoundException(NotFoundException exception, HttpServletRequest request) {
		logInfo(request, exception.getCode().getStatus(), exception.getMessage());
		return ApiResponse.error(exception.getCode());
	}

	@ResponseStatus(HttpStatus.FORBIDDEN)
	@ExceptionHandler(ForbiddenException.class)
	public ApiResponse<Object> handlerForbiddenException(ForbiddenException exception, HttpServletRequest request) {
		logInfo(request, exception.getCode().getStatus(), exception.getMessage());
		return ApiResponse.error(exception.getCode());
	}

	@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
	@ExceptionHandler(Exception.class)
	public ApiResponse<Object> unhandledExceptionHandler(Exception exception, HttpServletRequest request) {
		logWarn(request, exception);
		return ApiResponse.error(ErrorCode.SERVER_ERROR);
	}
}
```

<br><br>

## í”„ë¡œí•„ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ì„±ëŠ¥ ê°œì„ 
### ë¬¸ì œ ìƒí™©
í”„ë¡œí•„ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ì‹œ ê°€ì… ëª©ì ê³¼ ì·¨ë¯¸, ê±°ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œìˆœ ì •ë ¬ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ DB êµ¬ì¡°ëŠ” ê°€ì… ëª©ì (Purpose)ê³¼ ì·¨ë¯¸(Interest) í…Œì´ë¸”ì´ ë³„ë„ë¡œ ì¡´ì¬í•´, í”„ë¡œí•„ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•œ í›„ ê°€ì… ëª©ì ê³¼ ì·¨ë¯¸ë¥¼ ë°˜ë³µë¬¸ìœ¼ë¡œ ëŒë©° í•˜ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ë¡œ í•©ì¹˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

ê·¸ ê²°ê³¼ APIì˜ ì‘ë‹µ ì†ë„ê°€ 8ì´ˆ ê°€ëŸ‰ ì†Œìš”ë˜ì—ˆìŠµë‹ˆë‹¤.

```java
List<String> myPurposes = new ArrayList<>();
profilePurposeRepository.findAllByProfile(myProfile).forEach(p -> { myPurposes.add(p.getPurpose()); });

List<String> myInterests = new ArrayList<>();
profileInterestRepository.findAllByProfile(myProfile).forEach(i -> { myInterests.add(i.getInterest()); });
```

### í•´ê²° ë°©ì•ˆ
ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ë‹¤ìŒ ë‘ ê°€ì§€ ë°©ì•ˆìœ¼ë¡œ ê³ ë ¤í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

1. DB I/Oë¥¼ ì¤„ì´ê¸° ìœ„í•´ joiní•˜ëŠ” sqlì„ ì§ì ‘ ì§ ë‹¤.
2. ê°€ì…ëª©ì ê³¼ ì·¨ë¯¸ í…Œì´ë¸”ì„ í”„ë¡œí•„ í…Œì´ë¸”ì— í•©ì¹œë‹¤.

ê°€ì…ëª©ì ê³¼ ì·¨ë¯¸ê°€ í”„ë¡œí•„ ì¡°íšŒ ì‹œ ê±°ì˜ í•­ìƒ í•¨ê»˜ ì¡°íšŒëœë‹¤ëŠ” ì ì„ ê³ ë ¤í•´ 2ë²ˆ ë°˜ì •ê·œí™”ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.

í”„ë¡œí•„ê³¼ ê°€ì…ëª©ì , ì·¨ë¯¸ëŠ” 1:N ê´€ê³„ì´ê¸° ë•Œë¬¸ì—, ë³„ë„ì˜ Converterë¥¼ êµ¬í˜„í•˜ì—¬ ê°€ì…ëª©ì ê³¼ ì·¨ë¯¸ ì¹¼ëŸ¼ì— ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```java
@Converter
public class StringListConverter implements AttributeConverter<List<String>, String> {
	private static final String SPLIT_CHAR = ";";

	@Override
	public String convertToDatabaseColumn(List<String> stringList) {
		return String.join(SPLIT_CHAR, stringList);
	}

	@Override
	public List<String> convertToEntityAttribute(String string) {
		return Arrays.asList(string.split(SPLIT_CHAR));
	}
}
```
```java
@Column(nullable = false)
@Convert(converter = StringListConverter.class)
private List<String> purpose;

@Column(nullable = false)
@Convert(converter = StringListConverter.class)
private List<String> interest;
```

### ê²°ê³¼
í”„ë¡œí•„ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ APIì˜ ì‘ë‹µ ì†ë„ëŠ” ì•½ 3ì´ˆë¡œ, ê¸°ì¡´ ëŒ€ë¹„ 2.6ë°° í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤. 

<br><br>

## í´ë” êµ¬ì¡°
```bash
â”œâ”€â”€ DagatherApplication.java
â”œâ”€â”€ common
â”‚Â Â  â”œâ”€â”€ config
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ RestTemplateConfig.java
â”‚Â Â  â”‚Â Â  â””â”€â”€ WebMvcConfig.java
â”‚Â Â  â”œâ”€â”€ exception
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ CustomException.java
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ DuplicateException.java
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ForbiddenException.java
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ NotFoundException.java
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ NumberFormatException.java
â”‚Â Â  â”‚Â Â  â””â”€â”€ RestExceptionHandler.java
â”‚Â Â  â”œâ”€â”€ response
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ApiResponse.java
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ErrorCode.java
â”‚Â Â  â”‚Â Â  â””â”€â”€ SuccessCode.java
â”‚Â Â  â””â”€â”€ util
â”‚Â Â      â”œâ”€â”€ AuthUtil.java
â”‚Â Â      â””â”€â”€ S3Util.java
â””â”€â”€ domain
    â”œâ”€â”€ friend
    â”‚Â Â  â”œâ”€â”€ controller
    â”‚Â Â  â”‚Â Â  â””â”€â”€ FriendController.java
    â”‚Â Â  â”œâ”€â”€ dto
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ FriendChatroomRequestDto.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ FriendChatroomResponseDto.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ FriendListResponseDto.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ FriendMapper.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ FriendRequestDto.java
    â”‚Â Â  â”‚Â Â  â””â”€â”€ FriendResponseDto.java
    â”‚Â Â  â”œâ”€â”€ entity
    â”‚Â Â  â”‚Â Â  â””â”€â”€ Friend.java
    â”‚Â Â  â”œâ”€â”€ repository
    â”‚Â Â  â”‚Â Â  â””â”€â”€ FriendRepository.java
    â”‚Â Â  â””â”€â”€ service
    â”‚Â Â      â””â”€â”€ FriendService.java
    â”œâ”€â”€ mission
    â”‚Â Â  â”œâ”€â”€ controller
    â”‚Â Â  â”‚Â Â  â””â”€â”€ MissionController.java
    â”‚Â Â  â”œâ”€â”€ dto
    â”‚Â Â  â”‚Â Â  â””â”€â”€ MissionSaveRequestDto.java
    â”‚Â Â  â”œâ”€â”€ entity
    â”‚Â Â  â”‚Â Â  â””â”€â”€ Mission.java
    â”‚Â Â  â”œâ”€â”€ repository
    â”‚Â Â  â”‚Â Â  â””â”€â”€ MissionRepository.java
    â”‚Â Â  â””â”€â”€ service
    â”‚Â Â      â””â”€â”€ MissionService.java
    â”œâ”€â”€ mission_complete
    â”‚Â Â  â”œâ”€â”€ controller
    â”‚Â Â  â”‚Â Â  â””â”€â”€ MissionCompleteController.java
    â”‚Â Â  â”œâ”€â”€ dto
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MissionCompleteCountResponseDto.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MissionCompleteProfileResponseDto.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MissionCompleteResponseDto.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MissionCompleteSaveRequestDto.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MissionCompleteSaveResponseDto.java
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ MissionCompleteUpdateRequestDto.java
    â”‚Â Â  â”‚Â Â  â””â”€â”€ MissionCompleteUpdateResponseDto.java
    â”‚Â Â  â”œâ”€â”€ entity
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ BaseTimeEntity.java
    â”‚Â Â  â”‚Â Â  â””â”€â”€ MissionComplete.java
    â”‚Â Â  â”œâ”€â”€ repository
    â”‚Â Â  â”‚Â Â  â””â”€â”€ MissionCompleteRepository.java
    â”‚Â Â  â””â”€â”€ service
    â”‚Â Â      â””â”€â”€ MissionCompleteService.java
    â””â”€â”€ profile
        â”œâ”€â”€ controller
        â”‚Â Â  â””â”€â”€ ProfileController.java
        â”œâ”€â”€ dto
        â”‚Â Â  â”œâ”€â”€ ProfileGetListResponseDto.java
        â”‚Â Â  â”œâ”€â”€ ProfileGetResponseDto.java
        â”‚Â Â  â”œâ”€â”€ ProfileImagePostRequestDto.java
        â”‚Â Â  â”œâ”€â”€ ProfileImagePostResponseDto.java
        â”‚Â Â  â”œâ”€â”€ ProfileInterestDto.java
        â”‚Â Â  â”œâ”€â”€ ProfileMapper.java
        â”‚Â Â  â”œâ”€â”€ ProfilePurposeDto.java
        â”‚Â Â  â”œâ”€â”€ ProfileRecommendRequestDto.java
        â”‚Â Â  â”œâ”€â”€ ProfileRecommendRequestItem.java
        â”‚Â Â  â”œâ”€â”€ ProfileRecommendResponseDto.java
        â”‚Â Â  â”œâ”€â”€ ProfileRequestDto.java
        â”‚Â Â  â””â”€â”€ ProfileResponseDto.java
        â”œâ”€â”€ entity
        â”‚Â Â  â”œâ”€â”€ Location.java
        â”‚Â Â  â”œâ”€â”€ Profile.java
        â”‚Â Â  â””â”€â”€ StringListConverter.java
        â”œâ”€â”€ repository
        â”‚Â Â  â”œâ”€â”€ LocationRepository.java
        â”‚Â Â  â””â”€â”€ ProfileRepository.java
        â””â”€â”€ service
            â””â”€â”€ ProfileService.java
```

<br><br>

# How to Start
### Installation
Git clone or download zip file

### Execution
1. build project
```
./gradlew build
```
2. run jar file
```
java -jar dagather-0.0.1-SNAPSHOT.jar
```
3. or you can just run application at intellij or STS
